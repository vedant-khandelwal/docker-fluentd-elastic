<source>
  type tail
  read_from_head true
  path /var/lib/docker/containers/*/*-json.log
  pos_file /var/log/fluentd-docker.pos
  time_format %Y-%m-%dT%H:%M:%S
  tag docker.*
  format json
</source>

# Using filter to add container IDs to each event
<filter docker.var.lib.docker.containers.*.*.log>
  type record_transformer
  <record>
    container ${tag_parts[5]}
    hostname "#{ENV['ENV_HOST']}"
    deployment "#{ENV['FALKONRY_URL']}"
  </record>
</filter>

<match docker.**>
  type elasticsearch
  logstash_format true
  host "#{ENV['ELASTIC_HOST']}"
  port "#{ENV['ELASTIC_PORT']}"
  index_name "#{ENV['ELASTIC_INDEX']}"
  buffer_chunk_limit 2M
  # Cap buffer memory usage to 2MiB/chunk * 32 chunks = 64 MiB
  buffer_queue_limit 32
  flush_interval 5s
</match>
